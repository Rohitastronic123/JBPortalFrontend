import { Component, OnInit } from '@angular/core';
import { Education, Experience, Resume, Skill } from './resume';
import pdfMake from 'pdfmake/build/pdfmake';
import pdfFonts from 'pdfmake/build/vfs_fonts';
pdfMake.vfs = pdfFonts.pdfMake.vfs; 
@Component({
  selector: 'app-resume-builder2',
  templateUrl: './resume-builder2.component.html',
  styleUrls: ['./resume-builder2.component.scss']
})
export class ResumeBuilder2Component implements OnInit {



  ngOnInit() {
  }

  
    resume = new Resume();
  
    degrees = ['B.E.', 'M.E.', 'B.Com', 'M.Com'];
  
    constructor() {
      this.resume = JSON.parse(sessionStorage.getItem('resume')) || new Resume();
      if (!this.resume.experiences || this.resume.experiences.length === 0) {
        this.resume.experiences = [];
        this.resume.experiences.push(new Experience());
      }
      if (!this.resume.educations || this.resume.educations.length === 0) {
        this.resume.educations = [];
        this.resume.educations.push(new Education());
      }
      if (!this.resume.skills || this.resume.skills.length === 0) {
        this.resume.skills = [];
        this.resume.skills.push(new Skill());
      }
    }
  
    addExperience() {
      this.resume.experiences.push(new Experience());
    }
  
    addEducation() {
      this.resume.educations.push(new Education());
    }
  
    generatePdf(action = 'open') {
      const documentDefinition = this.getDocumentDefinition();
  
      switch (action) {
        case 'open': pdfMake.createPdf(documentDefinition).open(); break;
        case 'print': pdfMake.createPdf(documentDefinition).print(); break;
        case 'download': pdfMake.createPdf(documentDefinition).download(); break;
  
        default: pdfMake.createPdf(documentDefinition).open(); break;
      }
  
    }
  
  
    resetForm() {
      this.resume = new Resume();
    }
  
    getDocumentDefinition() {
      sessionStorage.setItem('resume', JSON.stringify(this.resume));
  
      return {
        content: 'This is a sample PDF'
      };
    }
  
    fileChanged(e) {
      const file = e.target.files[0];
      this.getBase64(file);
    }
  
    getBase64(file) {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => {
        console.log(reader.result);
        this.resume.profilePic = reader.result as string;
      };
      reader.onerror = (error) => {
        console.log('Error: ', error);
      };
    }
  
    addSkill() {
      this.resume.skills.push(new Skill());
    }
  
  }
